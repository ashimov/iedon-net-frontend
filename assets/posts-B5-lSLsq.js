import{c as m,I as J,d as G,u as Z,a as Q,M as X,m as Y,r as g,o as ee,b as f,e as i,f as I,w as te,v as ae,g as r,n as oe,h as b,t as ne,i as A,p as H,j as k,F as x,k as K,S as se,l as L,q as S,L as le,s as T,x as j,y as re,V as ue,_ as ce}from"./index-tT9SxIPK.js";import{_ as ie}from"./MenuTrigger-BFUKn7uy.js";var de={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 394c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8H708V152c0-4.4-3.6-8-8-8h-64c-4.4 0-8 3.6-8 8v166H400V152c0-4.4-3.6-8-8-8h-64c-4.4 0-8 3.6-8 8v166H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h168v236H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h168v166c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V706h228v166c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V706h164c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8H708V394h164zM628 630H400V394h228v236z"}}]},name:"number",theme:"outlined"};function B(d){for(var a=1;a<arguments.length;a++){var o=arguments[a]!=null?Object(arguments[a]):{},p=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(o).filter(function(y){return Object.getOwnPropertyDescriptor(o,y).enumerable}))),p.forEach(function(y){pe(d,y,o[y])})}return d}function pe(d,a,o){return a in d?Object.defineProperty(d,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):d[a]=o,d}var M=function(a,o){var p=B({},a,o.attrs);return m(J,B({},p,{icon:de}),null)};M.displayName="NumberOutlined";M.inheritAttrs=!1;const ve={id:"wrapper"},_e={key:0,class:"pad"},fe={class:"header"},me=["innerHTML"],ye=G({__name:"posts",setup(d){const a=Z().t,o=Q(),p=o.currentRoute.value.params.id||null,y=new X({html:!0});y.use(Y,{attrs:{target:"_blank"}});const O=g(!1),u=g(null),n=g({}),P=g([]),w=g([]),c=g(!1),v=g(null),V=async t=>{var e,l;if(((e=u.value)==null?void 0:e.postId)!==t.postId)try{const s=H.get(`post_${t.postId}`);if(!s)v.value=t;else try{if(u.value=s,s.updatedAt===((l=n.value[s.category].find(h=>h.postId===s.postId))==null?void 0:l.updatedAt))return}catch(h){console.error(h)}u.value=await A(a,"/list",{type:"post",postId:t.postId})||null,u.value&&H.set(`post_${t.postId}`,u.value)}catch(s){console.error(s)}finally{v.value=null}},$=async t=>{n.value={},t.forEach(e=>{n.value[e.category]||(n.value[e.category]=[]),n.value[e.category].push(e)});try{w.value=[];for(const l in n.value)w.value.push(l);let e=!1;for(const l in n.value)if(p!==null){const s=n.value[l].find(h=>h.postId===Number(p));if(s){e=!0,P.value=[`post_${p}`],await V(s);break}continue}if(!e){o.replace({path:"/"});for(const l in n.value){P.value=[`post_${n.value[l][0].postId}`],await V(n.value[l][0]);break}}}catch(e){console.error(e)}},D=async()=>{let t=c.value;try{O.value=!0,c.value=!1;const e=await A(a,"/list",{type:"posts"});Array.isArray(e.posts)&&(localStorage.setItem("posts",JSON.stringify(e.posts)),await $(e.posts))}catch(e){console.error(e)}finally{O.value=!1,c.value=t}};ee(async()=>{try{const t=localStorage.getItem("posts");t&&await $(JSON.parse(t))}catch(t){console.error(t)}await D()});const E=async t=>{o.push({path:`/post/${t.postId}`}),window.scrollTo(0,0),(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<ue&&(c.value=!0),await V(t)},R=()=>{c.value=!c.value,window.scrollTo(0,0)};return(t,e)=>{const l=f("a-menu-item"),s=f("a-sub-menu"),h=f("a-menu"),W=f("a-spin"),z=f("a-layout-sider"),F=f("a-divider"),U=f("a-skeleton"),q=f("a-layout-content");return i(),I("section",ve,[te(m(z,{class:oe(`sider ${b(ne)}`),width:"300",collapsible:"",collapsed:c.value,"onUpdate:collapsed":e[2]||(e[2]=_=>c.value=_),trigger:null,breakpoint:"lg",collapsedWidth:40},{default:r(()=>[m(W,{spinning:O.value&&w.value.length===0},{default:r(()=>[O.value&&w.value.length===0?(i(),I("div",_e)):(i(),k(h,{key:1,class:"menu",mode:"inline",selectedKeys:P.value,"onUpdate:selectedKeys":e[0]||(e[0]=_=>P.value=_),openKeys:w.value,"onUpdate:openKeys":e[1]||(e[1]=_=>w.value=_)},{default:r(()=>[(i(!0),I(x,null,K(n.value,(_,C)=>(i(),k(s,{key:C},{icon:r(()=>[m(b(se))]),title:r(()=>[L("b",null,S(C),1)]),default:r(()=>[(i(!0),I(x,null,K(n.value[C],N=>(i(),k(l,{key:`post_${N.postId}`,onClick:he=>E(N)},{icon:r(()=>[v.value&&v.value.postId===N.postId?(i(),k(b(le),{key:0})):(i(),k(b(M),{key:1}))]),default:r(()=>[T(" "+S(N.title),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))]),_:1},8,["selectedKeys","openKeys"]))]),_:1},8,["spinning"])]),_:1},8,["class","collapsed"]),[[ae,!c.value]]),m(q,{class:"content"},{default:r(()=>{var _;return[L("h1",fe,S(v.value?v.value.title:((_=u.value)==null?void 0:_.title)||""),1),m(F,{orientation:"right"},{default:r(()=>[T(S(v.value?b(j)(v.value.updatedAt):u.value?b(j)(u.value.updatedAt):""),1)]),_:1}),m(U,{active:"",loading:v.value!==null},{default:r(()=>[u.value?(i(),I("article",{key:0,id:"post",innerHTML:b(y).render(u.value.content)},null,8,me)):re("",!0)]),_:1},8,["loading"])]}),_:1}),m(ie,{trigger:c.value,onClick:R},null,8,["trigger"])])}}}),we=ce(ye,[["__scopeId","data-v-121d06e9"]]);export{we as default};
