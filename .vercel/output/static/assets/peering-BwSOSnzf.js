import{c as o,I as Y,d as C,f as N,r as T,z as P,A as Q,B as W,i as d,o as a,e as f,j as l,u as t,L as B,g as U,a as g,D as Z,b as S,P as M,y as w,F as $,l as E,s as b,q as k,_ as A,M as K,m as ee,Q as ne,n as G,t as te,J as O,R as re,T as V,W as ae,X as oe,h as se,K as ie,H as j,Y as le,Z as pe,k as D}from"./index-BWyvaJGd.js";import{R as ue}from"./RouterLocationAvatar-DV68NB4O.js";import{H as ce,S as fe,a as de}from"./SmileTwoTone-BcFz1IlS.js";import{N as ve}from"./NodeIndexOutlined-B_mopQRy.js";import{S as H}from"./SendOutlined-C2CtP_Tp.js";var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M945 412H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h256c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM811 548H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h122c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM477.3 322.5H434c-6.2 0-11.2 5-11.2 11.2v248c0 3.6 1.7 6.9 4.6 9l148.9 108.6c5 3.6 12 2.6 15.6-2.4l25.7-35.1v-.1c3.6-5 2.5-12-2.5-15.6l-126.7-91.6V333.7c.1-6.2-5-11.2-11.1-11.2z"}},{tag:"path",attrs:{d:"M804.8 673.9H747c-5.6 0-10.9 2.9-13.9 7.7a321 321 0 01-44.5 55.7 317.17 317.17 0 01-101.3 68.3c-39.3 16.6-81 25-124 25-43.1 0-84.8-8.4-124-25-37.9-16-72-39-101.3-68.3s-52.3-63.4-68.3-101.3c-16.6-39.2-25-80.9-25-124 0-43.1 8.4-84.7 25-124 16-37.9 39-72 68.3-101.3 29.3-29.3 63.4-52.3 101.3-68.3 39.2-16.6 81-25 124-25 43.1 0 84.8 8.4 124 25 37.9 16 72 39 101.3 68.3a321 321 0 0144.5 55.7c3 4.8 8.3 7.7 13.9 7.7h57.8c6.9 0 11.3-7.2 8.2-13.3-65.2-129.7-197.4-214-345-215.7-216.1-2.7-395.6 174.2-396 390.1C71.6 727.5 246.9 903 463.2 903c149.5 0 283.9-84.6 349.8-215.8a9.18 9.18 0 00-8.2-13.3z"}}]},name:"field-time",theme:"outlined"};function X(_){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},u=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),u.forEach(function(c){ge(_,c,n[c])})}return _}function ge(_,e,n){return e in _?Object.defineProperty(_,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):_[e]=n,_}var z=function(e,n){var u=X({},e,n.attrs);return o(Y,X({},u,{icon:me}),null)};z.displayName="FieldTimeOutlined";z.inheritAttrs=!1;const _e=C({__name:"stepsBar",props:{step:{},loading:{type:Boolean}},setup(_){const e=_,n=N().t,u=T("finish"),c=T("wait"),r=T("wait"),s=T("wait"),i=P(()=>e.step),p=P(()=>e.loading),L=Q(()=>i.value,F=>{switch(F){case"interface":u.value="finish",c.value="process",r.value="wait",s.value="wait";break;case"setup":u.value="finish",c.value="finish",r.value="process",s.value="wait";break;case"done":u.value="finish",c.value="finish",r.value="finish",s.value="finish";break;default:case"preference":u.value="finish",c.value="wait",r.value="wait",s.value="wait";break}});return W(()=>{L()}),(F,v)=>{const y=d("a-step"),x=d("a-steps");return a(),f(x,null,{default:l(()=>[o(y,{status:u.value,title:t(n)("pages.peering.step1")},{icon:l(()=>[i.value==="preference"&&p.value?(a(),f(t(B),{key:0})):(a(),f(t(ce),{key:1}))]),_:1},8,["status","title"]),o(y,{status:c.value,title:t(n)("pages.peering.step2")},{icon:l(()=>[i.value==="interface"&&p.value?(a(),f(t(B),{key:0})):(a(),f(t(ve),{key:1}))]),_:1},8,["status","title"]),o(y,{status:r.value,title:t(n)("pages.peering.step3")},{icon:l(()=>[i.value==="setup"&&p.value?(a(),f(t(B),{key:0})):(a(),f(t(z),{key:1}))]),_:1},8,["status","title"]),o(y,{status:s.value,title:t(n)("pages.peering.step4")},{icon:l(()=>[i.value==="done"&&p.value?(a(),f(t(B),{key:0})):(a(),f(t(fe),{key:1}))]),_:1},8,["status","title"])]),_:1})}}}),ke=C({__name:"preferenceBox",props:{router:{},nextStep:{type:Function},preferenceForm:{}},setup(_){const e=_,n=N().t,u=U(),c=()=>{u.replace({path:"/nodes"}),window.scrollTo(0,0)};return(r,s)=>{const i=d("a-alert"),p=d("a-input"),L=d("a-form-item"),F=d("a-radio"),v=d("a-radio-group"),y=d("a-checkbox"),x=d("a-checkbox-group"),I=d("a-button"),h=d("a-form");return a(),g($,null,[o(i,{message:t(Z)(t(n)("pages.peering.step1Introduction")),type:"info"},null,8,["message"]),s[6]||(s[6]=S("br",null,null,-1)),o(h,{model:e.preferenceForm,"label-col":{span:8},"wrapper-col":{span:16},class:"peerInfoForm"},{default:l(()=>[t(M)?(a(),f(L,{key:0,name:"peerAsn",label:t(n)("pages.peering.asn")},{default:l(()=>[o(p,{type:"number",value:e.preferenceForm.asn,"onUpdate:value":s[0]||(s[0]=m=>e.preferenceForm.asn=m),"addon-before":"AS",placeholder:`${t(n)("pages.signIn.pleaseInput")} ${t(n)("pages.peering.asn")}`},null,8,["value","placeholder"])]),_:1},8,["label"])):w("",!0),o(L,{label:t(n)("pages.peering.linkType")},{default:l(()=>[o(v,{value:e.preferenceForm.linkType,"onUpdate:value":s[1]||(s[1]=m=>e.preferenceForm.linkType=m)},{default:l(()=>[(a(!0),g($,null,E(e.router.linkTypes,m=>(a(),f(F,{key:`linkType_${m}`,value:m},{default:l(()=>[b(k(t(n)(`pages.peering.${m}`)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),o(L,{label:t(n)("pages.peering.bgpExtensions")},{default:l(()=>[o(x,{value:e.preferenceForm.bgpExtensions,"onUpdate:value":s[2]||(s[2]=m=>e.preferenceForm.bgpExtensions=m)},{default:l(()=>[(a(!0),g($,null,E(e.router.extensions,m=>(a(),f(y,{key:`extension_${m}`,value:m},{default:l(()=>[b(k(t(n)(`pages.peering['${m}']`)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),s[5]||(s[5]=S("br",null,null,-1)),o(L,{"wrapper-col":{offset:8,span:16}},{default:l(()=>[o(I,{style:{"margin-right":"20px"},onClick:s[3]||(s[3]=m=>c())},{default:l(()=>[b(k(t(n)("pages.peering.backTop")),1)]),_:1}),o(I,{type:"primary",onClick:s[4]||(s[4]=m=>e.nextStep())},{icon:l(()=>[o(t(H))]),default:l(()=>[b(" "+k(t(n)("pages.signIn.continue")),1)]),_:1})]),_:1})]),_:1},8,["model"])],64)}}}),ye=A(ke,[["__scopeId","data-v-892c0cdd"]]),be={class:"detail"},Fe={key:0},Ie={key:1},Le={key:2},he={key:3},xe=["innerHTML"],we=["innerHTML"],Se=C({__name:"peerInfoCard",props:{router:{},routerInfo:{}},setup(_){const e=new K;e.use(ee,{attrs:{target:"_blank"}});const n=_,u=N().t;return(c,r)=>(a(),g("div",{class:G(`info ${t(te)}`)},[S("h2",null,k(t(u)("pages.peering.step2Introduction")),1),S("ul",be,[n.router.ipv4?(a(),g("li",Fe,[r[0]||(r[0]=b("ASN")),S("code",null,k(t(ne).netAsn),1)])):w("",!0),n.router.ipv4?(a(),g("li",Ie,[r[1]||(r[1]=b("IPv4")),S("code",null,k(n.router.ipv4),1)])):w("",!0),n.router.ipv6?(a(),g("li",Le,[r[2]||(r[2]=b("IPv6")),S("code",null,k(n.router.ipv6),1)])):w("",!0),n.router.ipv6LinkLocal?(a(),g("li",he,[r[3]||(r[3]=b("IPv6 Link Local")),S("code",null,k(n.router.ipv6LinkLocal),1)])):w("",!0)]),n.router.description?(a(),g("div",{key:0,class:"desc",innerHTML:t(e).render(n.router.description)},null,8,xe)):w("",!0),n.routerInfo&&n.routerInfo.info?(a(),g("div",{key:1,class:"desc",innerHTML:t(e).render(n.routerInfo.info)},null,8,we)):w("",!0)],2))}}),q=A(Se,[["__scopeId","data-v-a40847fa"]]),$e=C({__name:"interfaceBox",props:{router:{},nextStep:{type:Function},prevStep:{type:Function},routerInfo:{},preferenceForm:{},interfaceForm:{}},setup(_){const e=_,n=N().t,u=()=>{if(!e.interfaceForm.ipv4&&!e.interfaceForm.ipv6&&!e.interfaceForm.ipv6LinkLocal||!e.interfaceForm.useIpv4&&!e.interfaceForm.useIpv6&&!e.interfaceForm.useIpv6LinkLocal){O.error({centered:!0,title:n("pages.peering.step2"),content:n("pages.peering.mustEnableAtleastOneProtocol")});return}if(e.preferenceForm.linkType!=="direct"&&!e.interfaceForm.credential){O.error({centered:!0,title:n("pages.peering.step2"),content:n("pages.peering.mustEnterTunnelInformation")});return}if(!e.routerInfo||!e.routerInfo.passthrough){O.error({centered:!0,title:n("pages.peering.step2"),content:n("pages.signIn.errorOccurred")});return}if(e.interfaceForm.useIpv4&&!e.interfaceForm.ipv4||e.interfaceForm.useIpv6&&!e.interfaceForm.ipv6||e.interfaceForm.ipv6LinkLocal&&!e.interfaceForm.ipv6LinkLocal){O.error({centered:!0,title:n("pages.peering.step2"),content:n("pages.peering.inputValid")});return}e.interfaceForm.useIpv4||(e.interfaceForm.ipv4=""),e.interfaceForm.useIpv6||(e.interfaceForm.ipv6=""),e.interfaceForm.useIpv6LinkLocal||(e.interfaceForm.ipv6LinkLocal="");try{if(e.interfaceForm.ipv4!==""&&!re.test(e.interfaceForm.ipv4)||e.interfaceForm.ipv6!==""&&!V.test(e.interfaceForm.ipv6)||e.interfaceForm.ipv6LinkLocal!==""&&!V.test(e.interfaceForm.ipv6LinkLocal))throw new Error("Invalid IP");if(e.interfaceForm.endpoint.trim()!==""){if(e.interfaceForm.endpoint.indexOf(":")===-1)throw new Error("Invalid endpoint");const c=new URL(`https://${e.interfaceForm.endpoint}`);e.interfaceForm.endpoint=c.host}else e.interfaceForm.endpoint=""}catch{O.error({centered:!0,title:n("pages.peering.step2"),content:n("pages.peering.inputValid")});return}e.nextStep(),window.scrollTo(0,0)};return(c,r)=>{const s=d("a-switch"),i=d("a-form-item"),p=d("a-textarea"),L=d("a-button"),F=d("a-form");return a(),g($,null,[o(q,{router:e.router,"router-info":e.routerInfo},null,8,["router","router-info"]),o(F,{model:e.preferenceForm,class:"peerInfoForm"},{default:l(()=>[o(i,{label:t(n)("pages.peering.useIpv4")},{default:l(()=>[o(s,{checked:e.interfaceForm.useIpv4,"onUpdate:checked":r[0]||(r[0]=v=>e.interfaceForm.useIpv4=v)},null,8,["checked"])]),_:1},8,["label"]),e.interfaceForm.useIpv4?(a(),f(i,{key:0,name:"ipv4",label:t(n)("pages.peering.ipv4")},{default:l(()=>[o(p,{"auto-size":"",value:e.interfaceForm.ipv4,"onUpdate:value":r[1]||(r[1]=v=>e.interfaceForm.ipv4=v),placeholder:`${t(n)("pages.signIn.pleaseInput")} ${t(n)("pages.peering.ipv4")}`},null,8,["value","placeholder"])]),_:1},8,["label"])):w("",!0),o(i,{label:t(n)("pages.peering.useIpv6")},{default:l(()=>[o(s,{checked:c.interfaceForm.useIpv6,"onUpdate:checked":r[2]||(r[2]=v=>c.interfaceForm.useIpv6=v)},null,8,["checked"])]),_:1},8,["label"]),e.interfaceForm.useIpv6?(a(),f(i,{key:1,name:"ipv6",label:t(n)("pages.peering.ipv6")},{default:l(()=>[o(p,{"auto-size":"",value:e.interfaceForm.ipv6,"onUpdate:value":r[3]||(r[3]=v=>e.interfaceForm.ipv6=v),placeholder:`${t(n)("pages.signIn.pleaseInput")} ${t(n)("pages.peering.ipv6")}`},null,8,["value","placeholder"])]),_:1},8,["label"])):w("",!0),o(i,{label:t(n)("pages.peering.useIpv6LinkLocal")},{default:l(()=>[o(s,{checked:c.interfaceForm.useIpv6LinkLocal,"onUpdate:checked":r[4]||(r[4]=v=>c.interfaceForm.useIpv6LinkLocal=v)},null,8,["checked"])]),_:1},8,["label"]),e.interfaceForm.useIpv6LinkLocal?(a(),f(i,{key:2,name:"ipv6LinkLocal",label:t(n)("pages.peering.ipv6LinkLocal")},{default:l(()=>[o(p,{"auto-size":"",value:e.interfaceForm.ipv6LinkLocal,"onUpdate:value":r[5]||(r[5]=v=>e.interfaceForm.ipv6LinkLocal=v),placeholder:`${t(n)("pages.signIn.pleaseInput")} ${t(n)("pages.peering.ipv6LinkLocal")}`},null,8,["value","placeholder"])]),_:1},8,["label"])):w("",!0),c.preferenceForm.linkType!=="direct"?(a(),g($,{key:3},[o(i,{name:"endpoint",label:t(n)("pages.peering.endpoint")},{default:l(()=>[o(p,{"auto-size":"",value:e.interfaceForm.endpoint,"onUpdate:value":r[6]||(r[6]=v=>e.interfaceForm.endpoint=v),placeholder:`${t(n)("pages.peering.tunnelEndpointHint")}`},null,8,["value","placeholder"])]),_:1},8,["label"]),o(i,{name:"credential",label:t(n)("pages.peering.credential")},{default:l(()=>[o(p,{"auto-size":"",value:e.interfaceForm.credential,"onUpdate:value":r[7]||(r[7]=v=>e.interfaceForm.credential=v),placeholder:`${t(n)("pages.peering.tunnelCredentialHint")}`},null,8,["value","placeholder"])]),_:1},8,["label"])],64)):w("",!0),r[9]||(r[9]=S("br",null,null,-1)),o(i,{"wrapper-col":{offset:8,span:16}},{default:l(()=>[o(L,{style:{"margin-right":"20px"},onClick:r[8]||(r[8]=v=>e.prevStep())},{default:l(()=>[b(k(t(n)("pages.peering.back")),1)]),_:1}),o(L,{type:"primary",onClick:u},{icon:l(()=>[o(t(H))]),default:l(()=>[b(" "+k(t(n)("pages.signIn.continue")),1)]),_:1})]),_:1})]),_:1},8,["model"])],64)}}}),Te=A($e,[["__scopeId","data-v-17abc537"]]),Oe={class:"header"},Ce={class:"buttons"},Ne=C({__name:"setupBox",props:{nextStep:{type:Function},prevStep:{type:Function},router:{},routerInfo:{},loading:{type:Boolean},preferenceForm:{},interfaceForm:{}},setup(_){const e=N().t,n=_,u=P(()=>{const s={};for(const i in n.interfaceForm){const p=n.interfaceForm[i];(typeof p=="string"&&p!==""||typeof p!="string"&&!p)&&Object.assign(s,{[i]:p})}return s}),c=P(()=>{const s={};for(const i in n.preferenceForm){const p=n.preferenceForm[i];i!=="asn"&&Object.assign(s,{[i]:p})}return s}),r=P(()=>n.loading);return(s,i)=>{const p=d("a-descriptions-item"),L=d("a-descriptions"),F=d("a-button"),v=d("a-spin");return a(),f(v,{spinning:r.value},{default:l(()=>[S("h2",Oe,k(t(e)("pages.peering.step3Introduction")),1),o(L,{layout:"vertical",bordered:"",size:"small",column:2,class:"summary"},{default:l(()=>[(a(!0),g($,null,E(c.value,(y,x)=>(a(),f(p,{key:`preferenceForm_${x}`,label:t(e)(`pages.peering['${x}']`)},{default:l(()=>[x==="linkType"?(a(),g($,{key:0},[b(k(t(e)(`pages.peering['${y}']`)),1)],64)):x==="bgpExtensions"&&Array.isArray(y)?(a(!0),g($,{key:1},E(y,I=>(a(),g("span",{class:"tag",key:I},k(t(e)(`pages.peering['${I}']`)),1))),128)):(a(),g($,{key:2},[b(k(y),1)],64))]),_:2},1032,["label"]))),128)),(a(!0),g($,null,E(u.value,(y,x)=>(a(),f(p,{key:`interfaceForm_${x}`,label:t(e)(`pages.peering['${x}']`)},{default:l(()=>[typeof y=="boolean"?(a(),g($,{key:0},[y?(a(),f(t(ae),{key:0})):(a(),f(t(oe),{key:1}))],64)):(a(),g($,{key:1},[b(k(y),1)],64))]),_:2},1032,["label"]))),128))]),_:1}),o(q,{router:n.router,"router-info":n.routerInfo},null,8,["router","router-info"]),S("div",Ce,[o(F,{onClick:i[0]||(i[0]=y=>n.prevStep())},{default:l(()=>[b(k(t(e)("pages.peering.back")),1)]),_:1}),o(F,{type:"primary",onClick:i[1]||(i[1]=y=>n.nextStep())},{icon:l(()=>[o(t(H))]),default:l(()=>[b(" "+k(t(e)("pages.signIn.continue")),1)]),_:1})])]),_:1},8,["spinning"])}}}),Pe=A(Ne,[["__scopeId","data-v-320a84a4"]]),Ee=C({__name:"doneBox",props:{router:{}},setup(_){const e=N().t,n=U(),u=_,c=()=>{n.replace({path:"/manage"})},r=()=>{n.replace({path:"/"})};return(s,i)=>{const p=d("a-button"),L=d("a-result");return a(),f(L,{title:t(e)("pages.peering.thankYou"),"sub-title":u.router.autoPeering?t(e)("pages.peering.step4Introduction"):t(e)("pages.peering.step4IntroductionReview")},{icon:l(()=>[o(t(de))]),extra:l(()=>[o(p,{key:"manageSessions",type:"primary",onClick:c},{default:l(()=>[b(k(t(e)("pages.signIn.manageSessions")),1)]),_:1}),o(p,{key:"topPage",onClick:r},{default:l(()=>[b(k(t(e)("pages.signIn.topPage")),1)]),_:1})]),_:1},8,["title","sub-title"])}}}),Ae={key:0,class:"header"},Be={class:"avatar"},Me=C({__name:"peering",setup(_){var y,x;const e=N().t,n=U(),u=T(!1),c=n.currentRoute.value.params.uuid||null,r=T(null);try{const I=localStorage.getItem("routers");I&&(r.value=JSON.parse(I).find(h=>h.uuid===c)||null)}catch(I){console.error(I)}const s=T("preference");se(()=>{if(window.scrollTo(0,0),!ie.value){j.info(e("pages.nodes.pleaseSignIn")),n.replace({path:"/signin"});return}if(!r.value){j.error(e("pages.peering.couldNotGetData")),n.back();return}});const i=T({asn:"424242",linkType:((y=r.value)==null?void 0:y.linkTypes[0])||"",bgpExtensions:((x=r.value)==null?void 0:x.extensions)||[]}),p=T(null),L=async()=>{var I;if(M.value&&(i.value.asn===""||isNaN(Number(i.value.asn))||Number(i.value.asn)<le||Number(i.value.asn)>pe)){O.error({centered:!0,title:"Admin Peering",content:`${e("pages.signIn.pleaseInput")} ${e("pages.peering.asn")}`});return}try{p.value=null,u.value=!0;const h=await D(e,"/session",{action:"info",router:(I=r.value)==null?void 0:I.uuid,data:{linkType:i.value.linkType,bgpExtensions:i.value.bgpExtensions}});if(h.success&&h.response){const m=h.response;m&&(p.value=m)}s.value="interface",window.scrollTo(0,0)}catch(h){console.error(h)}finally{u.value=!1}},F=T({useIpv4:!0,ipv4:"",useIpv6:!0,ipv6:"",useIpv6LinkLocal:!0,ipv6LinkLocal:"",endpoint:"",credential:""}),v=async()=>{var I;try{u.value=!0;const h={action:"add",router:(I=r.value)==null?void 0:I.uuid,ipv4:F.value.ipv4,ipv6:F.value.ipv6,ipv6LinkLocal:F.value.ipv6LinkLocal,type:i.value.linkType,extensions:i.value.bgpExtensions,endpoint:F.value.endpoint,credential:F.value.credential,data:p.value};M.value&&Object.assign(h,{asn:Number(i.value.asn)});const m=await D(e,"/session",h);if(m.success&&m.response){s.value="done",window.scrollTo(0,0);return}O.error({centered:!0,title:e("pages.peering.step3"),content:e("pages.signIn.errorOccurred")})}catch(h){console.error(h)}finally{u.value=!1}};return(I,h)=>{var R;const m=d("a-spin"),J=d("a-layout-content");return a(),g("section",null,[r.value?(a(),g("h1",Ae,[S("div",Be,[o(ue,{router:r.value},null,8,["router"])]),b(" "+k((R=r.value)==null?void 0:R.name),1)])):w("",!0),r.value?(a(),f(J,{key:1,id:"peering"},{default:l(()=>[o(_e,{class:"steps",step:s.value,loading:u.value},null,8,["step","loading"]),o(m,{spinning:u.value},{default:l(()=>[S("section",{class:G(`box ${s.value||""}`)},[s.value==="preference"?(a(),f(ye,{key:0,router:r.value,"preference-form":i.value,nextStep:L},null,8,["router","preference-form"])):s.value==="interface"?(a(),f(Te,{key:1,router:r.value,"router-info":p.value,"preference-form":i.value,"interface-form":F.value,nextStep:()=>s.value="setup",prevStep:()=>s.value="preference"},null,8,["router","router-info","preference-form","interface-form","nextStep","prevStep"])):s.value==="setup"?(a(),f(Pe,{key:2,"preference-form":i.value,loading:u.value,router:r.value,"router-info":p.value,"interface-form":F.value,nextStep:v,prevStep:()=>s.value="interface"},null,8,["preference-form","loading","router","router-info","interface-form","prevStep"])):s.value==="done"?(a(),f(Ee,{key:3,router:r.value},null,8,["router"])):w("",!0)],2)]),_:1},8,["spinning"])]),_:1})):w("",!0)])}}}),je=A(Me,[["__scopeId","data-v-6d07d345"]]);export{je as default};
