import{d as P,f as F,r as h,z as M,A as Z,B as ee,i,o as p,e as v,j as n,c as o,u as e,L as U,C as ae,U as te,D as B,b as w,s as K,q as $,a as Q,l as G,E as N,F as V,G as j,y as J,H as L,g as ne,h as X,k as D,J as E,K as se,_ as le}from"./index-BWyvaJGd.js";import{H as oe,S as ue,a as ie}from"./SmileTwoTone-BcFz1IlS.js";import{S as z}from"./SendOutlined-C2CtP_Tp.js";const re=P({__name:"stepsBar",props:{step:{},customQueryTitle:{},customChooseTitle:{},loading:{type:Boolean}},setup(A){const a=A,t=F().t,s=h("finish"),g=h("wait"),_=h("wait"),d=h("wait"),y=M(()=>a.step),l=M(()=>a.loading),r=M(()=>a.customQueryTitle),u=M(()=>a.customChooseTitle),R=Z(()=>y.value,C=>{switch(C){case"choose":s.value="finish",g.value="process",_.value="wait",d.value="wait";break;case"challenge":s.value="finish",g.value="finish",_.value="process",d.value="wait";break;case"done":s.value="finish",g.value="finish",_.value="finish",d.value="finish";break;default:case"query":s.value="finish",g.value="wait",_.value="wait",d.value="wait";break}});return ee(()=>{R()}),(C,x)=>{const c=i("a-step"),f=i("a-steps");return p(),v(f,null,{default:n(()=>[o(c,{status:s.value,title:`${r.value||e(t)("pages.signIn.step1")}`},{icon:n(()=>[y.value==="query"&&l.value?(p(),v(e(U),{key:0})):(p(),v(e(ae),{key:1}))]),_:1},8,["status","title"]),o(c,{status:g.value,title:`${u.value||e(t)("pages.signIn.step2")}`},{icon:n(()=>[y.value==="choose"&&l.value?(p(),v(e(U),{key:0})):(p(),v(e(oe),{key:1}))]),_:1},8,["status","title"]),o(c,{status:_.value,title:e(t)("pages.signIn.step3")},{icon:n(()=>[y.value==="challenge"&&l.value?(p(),v(e(U),{key:0})):(p(),v(e(te),{key:1}))]),_:1},8,["status","title"]),o(c,{status:d.value,title:`${e(t)("pages.signIn.step4")}`},{icon:n(()=>[y.value==="done"&&l.value?(p(),v(e(U),{key:0})):(p(),v(e(ue),{key:1}))]),_:1},8,["status","title"])]),_:1})}}}),pe={href:"https://dn42.dev",target:"_blank"},ce=P({__name:"queryBox",props:{queryAsn:{type:Function},loading:{type:Boolean}},setup(A){const a=A,t=F().t,s=h({asn:Number(localStorage.getItem("lastAsn")||"424242")}),g=M(()=>a.loading);return(_,d)=>{const y=i("a-alert"),l=i("a-button"),r=i("a-input-search"),u=i("a-form-item"),R=i("a-form"),C=i("a-spin");return p(),v(C,{tip:`${e(t)("pages.signIn.queryingSignInMethod")}`,spinning:g.value},{default:n(()=>[o(y,{message:e(B)(e(t)("pages.signIn.step1Introduction")),type:"info"},null,8,["message"]),d[2]||(d[2]=w("br",null,null,-1)),o(R,{model:s.value,"label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[o(u,{name:"asn",label:e(t)("pages.signIn.asn"),rules:[{required:!0,message:`${e(t)("pages.signIn.pleaseInput")} ${e(t)("pages.signIn.asn")}`}]},{default:n(()=>[o(r,{style:{width:"320px"},type:"number",value:s.value.asn,"onUpdate:value":d[0]||(d[0]=x=>s.value.asn=x),onSearch:d[1]||(d[1]=x=>_.queryAsn(s.value.asn)),size:"large","addon-before":"AS",placeholder:"424242〇〇〇〇",disabled:_.loading},{enterButton:n(()=>[o(l,{type:"primary",disabled:_.loading},{icon:n(()=>[o(e(z))]),default:n(()=>[K(" "+$(e(t)("pages.signIn.signIn")),1)]),_:1},8,["disabled"])]),_:1},8,["value","disabled"])]),_:1},8,["label","rules"]),o(u,{"wrapper-col":{offset:8,span:16}},{default:n(()=>[w("a",pe,$(e(t)("pages.signIn.signUp")),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["tip","spinning"])}}}),ge={style:{"margin-left":"20px","font-style":"italic"}},de={style:{"word-break":"break-all","font-size":"12px","user-select":"text"}},ve=P({__name:"chooseBox",props:{authQueryResp:{},requestChallenge:{type:Function},loading:{type:Boolean},prevStep:{type:Function}},setup(A){const a=A,t=F().t,s=h({method:0}),g=M(()=>a.loading),_=M(()=>a.authQueryResp),d=h("desc_0"),y=r=>{var u;d.value=`desc_${(u=r.target)==null?void 0:u.value}`},l=r=>{r&&(s.value.method=Number(r.split("desc_")[1]))};return(r,u)=>{const R=i("a-alert"),C=i("a-collapse-panel"),x=i("a-collapse"),c=i("a-radio"),f=i("a-radio-group"),m=i("a-form-item"),S=i("a-button"),k=i("a-form"),q=i("a-spin");return p(),v(q,{tip:`${e(t)("pages.signIn.pleaseWait")}`,spinning:g.value},{default:n(()=>[o(R,{message:e(B)(e(t)("pages.signIn.step2Introduction")),type:"success"},null,8,["message"]),u[5]||(u[5]=w("br",null,null,-1)),o(k,{model:s.value,"label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[o(x,{accordion:"",activeKey:d.value,"onUpdate:activeKey":u[0]||(u[0]=I=>d.value=I),onChange:l},{default:n(()=>{var I;return[(p(!0),Q(V,null,G((I=_.value)==null?void 0:I.availableAuthMethods,b=>(p(),v(C,{key:`desc_${b.id}`},{header:n(()=>[w("b",null,$(b.id+1),1),w("span",ge,$(e(t)(`pages.signIn.authMethods[${b.type}]`)),1)]),default:n(()=>[w("span",de,$(b.data||(b.type===e(N).PASSWORD?e(t)("pages.signIn.useSitePassword"):"")),1)]),_:2},1024))),128))]}),_:1},8,["activeKey"]),u[4]||(u[4]=w("br",null,null,-1)),o(m,{label:e(t)("pages.signIn.authenticateWith")},{default:n(()=>[o(f,{value:s.value.method,"onUpdate:value":u[1]||(u[1]=I=>s.value.method=I)},{default:n(()=>{var I;return[(p(!0),Q(V,null,G((I=_.value)==null?void 0:I.availableAuthMethods,b=>(p(),v(c,{key:`method_${b.id}`,value:b.id,onChange:y},{default:n(()=>[K($(b.id+1)+" ("+$(e(t)(`pages.signIn.authMethods[${b.type}]`))+") ",1)]),_:2},1032,["value"]))),128))]}),_:1},8,["value"])]),_:1},8,["label"]),o(m,{"wrapper-col":{offset:8,span:16}},{default:n(()=>[o(S,{style:{"margin-right":"20px"},onClick:u[2]||(u[2]=I=>a.prevStep())},{default:n(()=>[K($(e(t)("pages.peering.back")),1)]),_:1}),o(S,{type:"primary",onClick:u[3]||(u[3]=I=>a.requestChallenge(s.value.method)),disabled:r.loading},{icon:n(()=>[o(e(z))]),default:n(()=>[K(" "+$(e(t)("pages.signIn.continue")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["tip","spinning"])}}}),_e={style:{"font-style":"italic"}},me=P({__name:"challengeBox",props:{authRequestResp:{},authQueryResp:{},selectedIndex:{},challenge:{type:Function},loading:{type:Boolean},type:{},prevStep:{type:Function}},setup(A){const a=A,t=F().t,s=h({publicKey:"",challengeText:""}),g=M(()=>a.loading),_=h("challengeHint"),d=async y=>{try{await navigator.clipboard.writeText(y),L.info(t("pages.nodes.copied"))}catch(l){console.error(l)}};return(y,l)=>{const r=i("a-alert"),u=i("a-collapse-panel"),R=i("a-collapse"),C=i("a-textarea"),x=i("a-form-item"),c=i("a-input-password"),f=i("a-button"),m=i("a-form"),S=i("a-spin");return p(),v(S,{tip:`${e(t)("pages.signIn.pleaseWait")}`,spinning:g.value},{default:n(()=>[o(r,{message:e(B)(e(t)("pages.signIn.step3Introduction")),type:"success"},null,8,["message"]),l[9]||(l[9]=w("br",null,null,-1)),o(m,{model:s.value,"label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[o(R,{accordion:"",activeKey:_.value,"onUpdate:activeKey":l[2]||(l[2]=k=>_.value=k)},{default:n(()=>[o(u,{key:"challengeHint"},{header:n(()=>[w("span",_e,$(e(t)("pages.signIn.challengeHint")),1)]),default:n(()=>{var k,q,I,b;return[a.type===e(N).PGP_ASCII_ARMORED_CLEAR_SIGN?(p(),Q("span",{key:0,onClick:l[0]||(l[0]=j(T=>{var O,H,W;return d(`echo
                        "${(O=a.authRequestResp)==null?void 0:O.authChallenge}" |
                        gpg --clearsign --armor -u ${(W=(H=a.authQueryResp)==null?void 0:H.availableAuthMethods.find(Y=>Number(Y.id)===y.selectedIndex))==null?void 0:W.data}`)},["stop"])),style:{"word-break":"break-all","font-size":"12px","user-select":"text","font-family":"\\'Courier New\\',Courier,monospace",cursor:"pointer"}},$(`echo
                        "${(k=a.authRequestResp)==null?void 0:k.authChallenge}" |
                        gpg --clearsign --armor -u ${(I=(q=a.authQueryResp)==null?void 0:q.availableAuthMethods.find(T=>Number(T.id)===y.selectedIndex))==null?void 0:I.data}`),1)):(p(),Q("span",{key:1,onClick:l[1]||(l[1]=j(T=>{var O;return d(((O=a.authRequestResp)==null?void 0:O.authChallenge)||"")},["stop"])),style:{"word-break":"break-all","font-size":"12px","user-select":"text","font-family":"\\'Courier New\\',Courier,monospace",cursor:"pointer"}},$((b=a.authRequestResp)==null?void 0:b.authChallenge),1))]}),_:1})]),_:1},8,["activeKey"]),l[8]||(l[8]=w("br",null,null,-1)),a.type===e(N).PGP_ASCII_ARMORED_CLEAR_SIGN?(p(),v(x,{key:0,name:"publicKey",label:`${e(t)("pages.signIn.pgpPublicKey")}`,rules:[{required:!0,message:`${e(t)("pages.signIn.pleaseInput")} ${e(t)("pages.signIn.pgpPublicKey")}`}]},{default:n(()=>[o(C,{"auto-size":"",value:s.value.publicKey,"onUpdate:value":l[3]||(l[3]=k=>s.value.publicKey=k),placeholder:`${e(t)("pages.signIn.pgpPublicKey")}`},null,8,["value","placeholder"])]),_:1},8,["label","rules"])):J("",!0),o(x,{name:"challengeText",label:e(t)("pages.signIn.challengeText"),rules:[{required:!0,message:`${e(t)("pages.signIn.pleaseInput")} ${e(t)("pages.signIn.challengeText")}`}]},{default:n(()=>[a.type===e(N).PASSWORD?(p(),v(c,{key:0,autocomplete:"password",value:s.value.challengeText,"onUpdate:value":l[4]||(l[4]=k=>s.value.challengeText=k),placeholder:e(t)("pages.signIn.challengeTextPlaceholder")},null,8,["value","placeholder"])):(p(),v(C,{key:1,"auto-size":"",value:s.value.challengeText,"onUpdate:value":l[5]||(l[5]=k=>s.value.challengeText=k),placeholder:`${e(t)("pages.signIn.challengeTextPlaceholder")}`},null,8,["value","placeholder"]))]),_:1},8,["label","rules"]),o(x,{"wrapper-col":{offset:8,span:16}},{default:n(()=>[o(f,{style:{"margin-right":"20px"},onClick:l[6]||(l[6]=k=>a.prevStep())},{default:n(()=>[K($(e(t)("pages.peering.back")),1)]),_:1}),o(f,{type:"primary",onClick:l[7]||(l[7]=k=>a.challenge(s.value)),disabled:y.loading},{icon:n(()=>[o(e(z))]),default:n(()=>[K(" "+$(e(t)("pages.signIn.continue")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["tip","spinning"])}}}),he=P({__name:"doneBox",setup(A){const a=F().t,t=ne(),s=h(""),g=h("");X(()=>{s.value=localStorage.getItem("asn")||"",g.value=localStorage.getItem("person")||""});const _=()=>{t.replace({path:"/manage"})},d=()=>{t.replace({path:"/"})};return(y,l)=>{const r=i("a-button"),u=i("a-result");return p(),v(u,{title:`${e(a)("pages.signIn.welcomeBack")} ${g.value||s.value||""}`,"sub-title":e(a)("pages.signIn.step4Introduction")},{icon:n(()=>[o(e(ie))]),extra:n(()=>[o(r,{key:"manageSessions",type:"primary",onClick:_},{default:n(()=>[K($(e(a)("pages.signIn.manageSessions")),1)]),_:1}),o(r,{key:"topPage",onClick:d},{default:n(()=>[K($(e(a)("pages.signIn.topPage")),1)]),_:1})]),_:1},8,["title","sub-title"])}}}),ye={class:"header"},fe={class:"box"},Ie=0,be=4294967295,ke=P({__name:"signin",setup(A){X(()=>{window.scrollTo(0,0)});const a=F().t,t=h("0"),s=h("query"),g=h(!1),_=h(""),d=h(N.PASSWORD),y=h(""),l=h(0),r=h(null),u=h(null),R=async c=>{if(t.value="0",!c||c<Ie||c>be){L.error(`${a("pages.signIn.pleaseInput")} ${a("pages.signIn.asn")}`);return}try{r.value=null,g.value=!0;const f=await D(a,"/auth",{action:"query",asn:c});if(f.success&&f.response){const m=f.response;if(!m||m.availableAuthMethods.length===0){E.error({centered:!0,title:a("pages.signIn.signIn"),content:B(a("pages.signIn.couldNotFindAuthMethod"))});return}r.value=m,s.value="choose",_.value=`${a("pages.signIn.hi")} ${m.person}`,t.value=c.toString(),window.scrollTo(0,0)}}catch(f){console.error(f)}finally{g.value=!1}},C=async c=>{var f;try{u.value=null,g.value=!0;const m=await D(a,"/auth",{action:"request",authMethod:c,authState:(f=r.value)==null?void 0:f.authState});if(m.success&&m.response){const S=m.response;if(!S||!S.authState||!S.authChallenge){E.error({centered:!0,title:a("pages.signIn.signIn"),content:B(a("pages.signIn.errorOccurred"))});return}u.value=S,s.value="challenge",r.value&&(l.value=c,d.value=r.value.availableAuthMethods[c].type,y.value=a(`pages.signIn.authMethodsTiny[${r.value.availableAuthMethods[c].type}]`),window.scrollTo(0,0))}}catch(m){console.error(m)}finally{g.value=!1}},x=async c=>{var f,m,S,k;if(c.challengeText===""){L.error(`${a("pages.signIn.pleaseInput")} ${a("pages.signIn.challengeText")}`);return}try{g.value=!0;let q="";c.publicKey?q={publicKey:c.publicKey,signedMessage:c.challengeText}:q=c.challengeText;const I=await D(a,"/auth",{action:"challenge",authState:(f=u.value)==null?void 0:f.authState,data:q});if(I.success&&I.response){const b=I.response;if(!b||!b.authResult){E.error({centered:!0,title:a("pages.signIn.signIn"),content:B(a("pages.signIn.signInFailed"))});return}b.token&&localStorage.setItem("token",b.token),localStorage.setItem("person",((m=r.value)==null?void 0:m.person)||""),(S=r.value)==null||S.availableAuthMethods.forEach(T=>{T&&T.type===N.EMAIL&&T.data&&localStorage.setItem("email",T.data)}),localStorage.setItem("asn",t.value),localStorage.setItem("lastAsn",t.value),se.value=!0,s.value="done",L.info(`${a("pages.signIn.welcomeBack")} ${((k=r.value)==null?void 0:k.person)||t.value}`),window.scrollTo(0,0)}}catch(q){console.error(q)}finally{g.value=!1}};return(c,f)=>{const m=i("a-layout-content");return p(),Q("section",null,[w("h1",ye,$(e(a)("pages.signIn.signIn")),1),o(m,{id:"signin"},{default:n(()=>[o(re,{class:"steps",step:s.value,"custom-query-title":_.value,"custom-choose-title":y.value,loading:g.value},null,8,["step","custom-query-title","custom-choose-title","loading"]),w("section",fe,[s.value==="query"?(p(),v(ce,{key:0,loading:g.value,"query-asn":R},null,8,["loading"])):s.value==="choose"?(p(),v(ve,{key:1,"prev-step":()=>s.value="query",loading:g.value,"auth-query-resp":r.value,"request-challenge":C},null,8,["prev-step","loading","auth-query-resp"])):s.value==="challenge"?(p(),v(me,{key:2,"prev-step":()=>s.value="choose",loading:g.value,"auth-request-resp":u.value,"auth-query-resp":r.value,selectedIndex:l.value,challenge:x,type:d.value},null,8,["prev-step","loading","auth-request-resp","auth-query-resp","selectedIndex","type"])):s.value==="done"?(p(),v(he,{key:3})):J("",!0)])]),_:1})])}}}),Ce=le(ke,[["__scopeId","data-v-013d2e6c"]]);export{Ce as default};
